# server_API
I will post soon
Distribution server

# Здравствуйте

## Все просто:
- три сущности в бд:
  - клиенты:
    - номер телефона клиента в формате 7XXXXXXXXXX (X - цифра от 0 до 9)
    - код мобильного оператора
    - тег (произвольная метка)
    - часовой пояс
  - рассылка:
    - дата начала
    - дата конца
    - фильтр
    - текст
  - сообщения:
    - дата и время создания (отправки)
    - статус отправки
    - id рассылки, в рамках которой было отправлено сообщение
    - id клиента, которому отправили
- при создани рассылки:
  - на основании фильтра выбираются клиенты
  - на основании часового пояса клиента и текста рассылки создаются сообщения
  - если на начало рассылки уже наступило все отправляется "немедленно"
  - в ином случае, каждую минуту будут отсылаться сообщения, время отправки которых "подошло"
  - рассылку можно изменять если неодно сообщение небыло отправлено
  - отправляются "id" сообщения, "phone" клиента, "text" рассылки(менять в send_messages() из server\sender\tasks.py)
- для работы нужно:
  - docker
  - WSL если вы используете windows
  - в функции get_url() из server\sender\tasks.py указать url доставки
  - в функции get_token() из server\sender\tasks.py указать способ авторизации
  - в терминале:
    - docker-compose build
    - docker compose run --rm web-app sh -c "python manage.py makemigrations"
    - docker compose run --rm web-app sh -c "python manage.py migrate"
    - docker-compose up
  - все
- работа осуществляется через API
- для админки: docker compose run --rm web-app sh -c "python manage.py createsuperuser"
  

## Планы на будущее:
- прикрутить тесты
- расширить админку
- сделать полноценную документацию

## Статус:
- 70% complete
- работотоспособен
- на паузе до октября 2023
